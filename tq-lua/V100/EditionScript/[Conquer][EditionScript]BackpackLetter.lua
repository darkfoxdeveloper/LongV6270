----------------------------------------------------------------------------
--Name:		[??][????]???.lua
--Purpose:	???
--Creator: 	??
--Created:	2015/05/27
----------------------------------------------------------------------------

-- ????
-- BackpackLetter_
-- LOGID	12000106

local tBackpackLetter_Activity = {}
	-- ���Ĳر�ͼ
	-- tBackpackLetter_Activity[3006699] = {}
	-- tBackpackLetter_Activity[3006699]["ActivityTime"] = "2015-06-11 00:00 2015-07-31 23:59"
	-- tBackpackLetter_Activity[3006699]["EventType"] = 135
	-- tBackpackLetter_Activity[3006699]["DataType"] = 9
	-- tBackpackLetter_Activity[3006699]["RewardData"] = 1
	-- tBackpackLetter_Activity[3006699]["RewardItem"] = 3006699
	-- tBackpackLetter_Activity[3006699]["RewardAttr"] = "0 1"
	-- tBackpackLetter_Activity[3006699]["NeedLevel"] = 120
	-- tBackpackLetter_Activity[3006699]["NeedMetempsychosis"] = 0

	--����ͼ����
	-- tBackpackLetter_Activity[3006797] = {}
	-- tBackpackLetter_Activity[3006797]["ActivityTime"] = "2015-07-02 00:00 2015-07-16 23:59"
	-- tBackpackLetter_Activity[3006797]["EventType"] = 135
	-- tBackpackLetter_Activity[3006797]["DataType"] = 27
	-- tBackpackLetter_Activity[3006797]["RewardData"] = 1
	-- tBackpackLetter_Activity[3006797]["RewardItem"] = 3006797
	-- tBackpackLetter_Activity[3006797]["RewardAttr"] = "0 1"
	-- tBackpackLetter_Activity[3006797]["NeedLevel"] = 1
	-- tBackpackLetter_Activity[3006797]["NeedMetempsychosis"] = 0

	-- VIP��Ȩ�ȼ����뿨
	-- tBackpackLetter_Activity[3006618] = {}
	-- tBackpackLetter_Activity[3006618]["ActivityTime"] = "2015-07-15 00:00 2015-07-22 23:59"
	-- tBackpackLetter_Activity[3006618]["EventType"] = 135
	-- tBackpackLetter_Activity[3006618]["DataType"] = 7
	-- tBackpackLetter_Activity[3006618]["RewardData"] = 1
	-- tBackpackLetter_Activity[3006618]["RewardItem"] = 3006618
	-- tBackpackLetter_Activity[3006618]["RewardAttr"] = "0 1"

	-- ���ձ���
	-- tBackpackLetter_Activity[3006619] = {}
	-- tBackpackLetter_Activity[3006619]["ActivityTime"] = "2015-07-09 00:00 2015-07-22 23:59"
	-- tBackpackLetter_Activity[3006619]["EventType"] = 135
	-- tBackpackLetter_Activity[3006619]["DataType"] = 8
	-- tBackpackLetter_Activity[3006619]["RewardData"] = 1
	-- tBackpackLetter_Activity[3006619]["RewardItem"] = 3006619
	-- tBackpackLetter_Activity[3006619]["RewardAttr"] = "0 1"

	-- ��Ƥ�����
	-- tBackpackLetter_Activity[3006281] = {}
	-- tBackpackLetter_Activity[3006281]["ActivityTime"] = "2015-07-14 00:00 2015-08-08 23:59"
	-- tBackpackLetter_Activity[3006281]["EventType"] = 134
	-- tBackpackLetter_Activity[3006281]["DataType"] = 30
	-- tBackpackLetter_Activity[3006281]["RewardData"] = 1
	-- tBackpackLetter_Activity[3006281]["RewardItem"] = 3006281
	-- tBackpackLetter_Activity[3006281]["RewardAttr"] = "0 1"
	-- tBackpackLetter_Activity[3006281]["NeedLevel"] = 80
	-- tBackpackLetter_Activity[3006281]["NeedMetempsychosis"] = 0

	-- ����ƥ˹����(�����»������)
	-- tBackpackLetter_Activity[3006697] = {}
	-- tBackpackLetter_Activity[3006697]["ActivityTime"] = "2015-07-23 00:00 2015-08-05 23:59"
	-- tBackpackLetter_Activity[3006697]["EventType"] = 136
	-- tBackpackLetter_Activity[3006697]["DataType"] = 7
	-- tBackpackLetter_Activity[3006697]["RewardData"] = 1
	-- tBackpackLetter_Activity[3006697]["RewardItem"] = 3006697
	-- tBackpackLetter_Activity[3006697]["RewardAttr"] = "0 1"
	-- tBackpackLetter_Activity[3006697]["NeedLevel"] = 120
	-- tBackpackLetter_Activity[3006697]["NeedMetempsychosis"] = 0
	-- tBackpackLetter_Activity[3006697]["Log"] = "0,0,0,0,10002414,2,%d,1"

	-- ��ĮѰ���
	-- tBackpackLetter_Activity[3006949] = {}
	-- tBackpackLetter_Activity[3006949]["ActivityTime"] = "2015-08-31 00:00 2015-09-12 23:59"
	-- tBackpackLetter_Activity[3006949]["EventType"] = 137
	-- tBackpackLetter_Activity[3006949]["DataType"] = 18
	-- tBackpackLetter_Activity[3006949]["RewardData"] = 1
	-- tBackpackLetter_Activity[3006949]["RewardItem"] = 3006949
	-- tBackpackLetter_Activity[3006949]["RewardAttr"] = "0 1"
	-- tBackpackLetter_Activity[3006949]["NeedLevel"] = 100
	-- tBackpackLetter_Activity[3006949]["NeedMetempsychosis"] = 0

	-- �¿������ϰ�����
	tBackpackLetter_Activity[3006938] = {}
	tBackpackLetter_Activity[3006938]["ActivityTime"] = "2015-09-10 00:00 2015-11-10 23:59"
	tBackpackLetter_Activity[3006938]["EventType"] = 136
	tBackpackLetter_Activity[3006938]["DataType"] = 37
	tBackpackLetter_Activity[3006938]["RewardData"] = 1
	tBackpackLetter_Activity[3006938]["RewardItem"] = 3006938
	tBackpackLetter_Activity[3006938]["RewardAttr"] = "0 1"
	tBackpackLetter_Activity[3006938]["NeedLevel"] = 0
	tBackpackLetter_Activity[3006938]["NeedMetempsychosis"] = 0

	--���µ�һ�
	tBackpackLetter_Activity[3007030] = {}
	tBackpackLetter_Activity[3007030]["ActivityTime"] = "2015-09-12 00:00 2015-09-25 23:59"
	tBackpackLetter_Activity[3007030]["EventType"] = 136
	tBackpackLetter_Activity[3007030]["DataType"] = 88
	tBackpackLetter_Activity[3007030]["RewardData"] = 1
	tBackpackLetter_Activity[3007030]["RewardItem"] = 3007030
	tBackpackLetter_Activity[3007030]["RewardAttr"] = "0 1"
	tBackpackLetter_Activity[3007030]["NeedLevel"] = 120
	tBackpackLetter_Activity[3007030]["NeedMetempsychosis"] = 0

	-- �����������
	tBackpackLetter_Activity[727505] = {}
	tBackpackLetter_Activity[727505]["EventType"] = 137
	tBackpackLetter_Activity[727505]["DataType"] = 11
	tBackpackLetter_Activity[727505]["RewardData"] = 1
	tBackpackLetter_Activity[727505]["RewardItem"] = 727505
	tBackpackLetter_Activity[727505]["RewardAttr"] = "0 1"
	tBackpackLetter_Activity[727505]["NeedLevel"] = 110
	tBackpackLetter_Activity[727505]["NeedMetempsychosis"] = 1

	-- �����
	tBackpackLetter_Activity[3007294] = {}
	tBackpackLetter_Activity[3007294]["EventType"] = 137
	tBackpackLetter_Activity[3007294]["DataType"] = 50
	tBackpackLetter_Activity[3007294]["RewardData"] = 1
	tBackpackLetter_Activity[3007294]["RewardItem"] = 3007294
	tBackpackLetter_Activity[3007294]["RewardAttr"] = "0 1"
	tBackpackLetter_Activity[3007294]["NeedLevel"] = 15
	tBackpackLetter_Activity[3007294]["NeedMetempsychosis"] = 2

			--��ʥ�ڱ�����
	tBackpackLetter_Activity[3004809] = {}
	tBackpackLetter_Activity[3004809]["ActivityTime"] = "2015-10-29 00:00 2015-11-04 23:59"
	tBackpackLetter_Activity[3004809]["EventType"] = 138
	tBackpackLetter_Activity[3004809]["DataType"] = 19
	tBackpackLetter_Activity[3004809]["RewardData"] = 1
	tBackpackLetter_Activity[3004809]["RewardItem"] = 3004809
	tBackpackLetter_Activity[3004809]["RewardAttr"] = "0 1"
	tBackpackLetter_Activity[3004809]["NeedLevel"] = 80
	tBackpackLetter_Activity[3004809]["NeedMetempsychosis"] = 0


	-- �ж��ڻ֮�ж��ڴ�ʹ
	tBackpackLetter_Activity[3004937] = {}
	tBackpackLetter_Activity[3004937]["ActivityTime"] = "2015-11-24 00:00 2015-11-30 23:59"
	tBackpackLetter_Activity[3004937]["EventType"] = 130
	tBackpackLetter_Activity[3004937]["DataType"] = 00
	tBackpackLetter_Activity[3004937]["RewardData"] = 1
	tBackpackLetter_Activity[3004937]["RewardItem"] = 3004937
	tBackpackLetter_Activity[3004937]["RewardAttr"] = "0 1"
	tBackpackLetter_Activity[3004937]["NeedLevel"] = 80
	tBackpackLetter_Activity[3004937]["NeedMetempsychosis"] = 0

	--boss�±�����
	tBackpackLetter_Activity[3007157] = {}
	tBackpackLetter_Activity[3007157]["ActivityTime"] = "2015-12-03 00:00 2015-12-16 23:59"
	tBackpackLetter_Activity[3007157]["EventType"] = 137
	tBackpackLetter_Activity[3007157]["DataType"] = 82
	tBackpackLetter_Activity[3007157]["RewardData"] = 1
	tBackpackLetter_Activity[3007157]["RewardItem"] = 3007157
	tBackpackLetter_Activity[3007157]["RewardAttr"] = "0 1"
	tBackpackLetter_Activity[3007157]["NeedLevel"] = 100
	tBackpackLetter_Activity[3007157]["NeedMetempsychosis"] = 0

local sBackpackLetter_Log = "0,0,0,0,12000106,2,%d,1"

-- ���޴���
function BackpackLetter_OnLine()
	for i,v in pairs(tBackpackLetter_Activity) do
		BackpackLetter_Condition(v)
	end
end

-- �����ж�
function BackpackLetter_Condition(v)
	----------------------------------------- 条件判断
	-- 活动时间判断
	--if v["ActivityTime"] ~= nil and (not Sys_ChkFullTime(v["ActivityTime"])) then
	--	return false
	--end

	if v["RewardItem"] == nil then
		return
	end

	-- 活动时间判断
	-- 判断是否在活动时间内
	if nActivityTime ~= nil then
		-- 配多个活动时间
		if type(nActivityTime) == "table" then
			for _,nTime in pairs(nActivityTime) do
				if Sys_ChkFullTime(nTime) then
					bGive = true
					break
				end
			end

			-- 配一个活动时间
		elseif Sys_ChkFullTime(nActivityTime) then
			bGive = true
		end
	end

	local nItemId = v["RewardItem"]

	-- 判断是否有这个物品
	if Item_ChkItem(nItemId) then
		return
	end

	local nEventType = v["EventType"]
	local nDataType = v["DataType"]

	-- 掩码判断
	if nEventType ~= nil and nDataType ~= nil and v["RewardData"] ~= nil then
		if Task_ChkStcValue(nEventType,nDataType,">=",v["RewardData"]) then
			return
		end
	end

	--职业判断
	if v["NeedLevel"] ~= nil and v["NeedMetempsychosis"] ~= nil then
		if not User_JudgeLevelAndMetempsychosis(v["NeedLevel"],v["NeedMetempsychosis"]) then
			return
		end
	end

	--职业判断
	if v["NeedPro"] ~= nil then
		if Get_UserProfession() < v["NeedPro"]["Pro1"] or Get_UserProfession() > v["NeedPro"]["Pro2"] then
			return
		end
	end

	-- 背包空间判断
	if not User_CheckLeftSpace(1) then
		User_TalkChannel2005(tBackpackLetter_Text[nItemId]["NoSpace"])
		return
	end

	----------------------------------------- 获得物品
	if nEventType ~= nil and nDataType ~= nil and v["RewardData"] ~= nil then
		Task_SetStatistic(nEventType,nDataType,v["RewardData"],1)
	end

	Item_AddNewItem(nItemId,v["RewardAttr"])

	local sLog = v["Log"] or string.format(sBackpackLetter_Log,nItemId)
	Sys_SaveActionFestivalLog(sLog)

	User_TalkChannel2005(tBackpackLetter_Text[nItemId]["RewardItem"])
end


tSystem_PlayLogin_Func = tSystem_PlayLogin_Func or {}
table.insert(tSystem_PlayLogin_Func,BackpackLetter_OnLine)
